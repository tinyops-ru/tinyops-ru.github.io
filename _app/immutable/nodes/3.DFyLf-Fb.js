import{c as M,a as f,f as N}from"../chunks/CDMyQmYh.js";import{i as je}from"../chunks/BUEVVwPE.js";import{o as Ve}from"../chunks/D7i0vi7u.js";import{v as k,x,t as g,n as P,ar as Xe,as as Ge,w as J,y as _,P as Ke,m as a,Z as $,A as S,V as c,at as Je,z as h,au as ve,ap as Qe}from"../chunks/DZOeNrKr.js";import{a as et,e as D,s as se}from"../chunks/DsVnW8rC.js";import{s as I,r as A,i as F,b as tt}from"../chunks/qQA4PF9a.js";import{I as L,s as rt,a as he,b as oe,c as at,r as nt,e as st,i as ot}from"../chunks/BZ6nVY0W.js";import{s as R}from"../chunks/Casyh3yu.js";function lt(i){return function(...r){var u=r[0];return u.preventDefault(),i==null?void 0:i.apply(this,r)}}function it(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];L(i,I({name:"plus"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function ct(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M5 12h14"}]];L(i,I({name:"minus"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function ut(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2"}],["path",{d:"M12 18h.01"}]];L(i,I({name:"smartphone"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function dt(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M12 15V3"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}],["path",{d:"m7 10 5 5 5-5"}]];L(i,I({name:"download"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function ft(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56"}]];L(i,I({name:"loader-circle"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function pt(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"}]];L(i,I({name:"moon"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}function vt(i,r){k(r,!0);let u=A(r,["$$slots","$$events","$$legacy"]);const p=[["circle",{cx:"12",cy:"12",r:"4"}],["path",{d:"M12 2v2"}],["path",{d:"M12 20v2"}],["path",{d:"m4.93 4.93 1.41 1.41"}],["path",{d:"m17.66 17.66 1.41 1.41"}],["path",{d:"M2 12h2"}],["path",{d:"M20 12h2"}],["path",{d:"m6.34 17.66-1.41 1.41"}],["path",{d:"m19.07 4.93-1.41 1.41"}]];L(i,I({name:"sun"},()=>u,{get iconNode(){return p},children:(v,w)=>{var l=M(),d=g(l);R(d,()=>r.children??P),f(v,l)},$$slots:{default:!0}})),x()}var ht=N("<!> Загрузка…",1),mt=N("<!> Загрузить",1),bt=N('<p class="status error svelte-18nuwd5" role="alert"> </p>'),_t=N('<p class="status svelte-18nuwd5">Загружается текст…</p>'),gt=N('<p class="separator svelte-18nuwd5" aria-hidden="true"> </p>'),wt=N('<p class="svelte-18nuwd5"> </p>'),yt=N('<article class="reader-content svelte-18nuwd5"></article>'),$t=N('<p class="status svelte-18nuwd5">Введите ссылку и нажмите «Загрузить», чтобы начать чтение.</p>'),Nt=N('<div class="page svelte-18nuwd5"><form class="controls svelte-18nuwd5"><label class="url-field svelte-18nuwd5"><span class="field-label svelte-18nuwd5">Адрес lib.ru</span> <input aria-label="Адрес lib.ru" autocomplete="url" inputmode="url" placeholder="https://lib.ru/..." type="url" class="svelte-18nuwd5"/></label> <div class="actions svelte-18nuwd5"><button class="button icon-only svelte-18nuwd5" type="button" aria-label="Уменьшить шрифт" title="Уменьшить шрифт"><!></button> <button class="button icon-only svelte-18nuwd5" type="button" aria-label="Увеличить шрифт" title="Увеличить шрифт"><!></button> <button type="button" aria-label="Переключить режим iOS" title="Режим iOS"><!></button> <button class="button icon-only svelte-18nuwd5" type="button"><!></button> <button class="button primary svelte-18nuwd5" type="submit"><!></button></div></form> <!> <section aria-live="polite"><!></section></div>');function At(i,r){k(r,!1);const u=.1,p=.8,v=2.5,w="libru:theme",l=new Set(["lib.ru","www.lib.ru"]),d="https://r.jina.ai/",me="text/plain, text/*;q=0.9, */*;q=0.1";let H=$(""),q=$(""),z=$(!1),y=$(""),E=$(1.2),B=$(!1),W=$("dark");const be=/^[\-=*_~]{3,}$/;let le=$([]),X=$(null);const ie={amp:"&",lt:"<",gt:">",quot:'"',apos:"'",nbsp:" "};Ve(()=>{const e=sessionStorage.getItem("libru:lastUrl");e&&c(H,e);const t=localStorage.getItem(w);if(t==="light"||t==="dark")Q(t);else{const n=window.matchMedia("(prefers-color-scheme: dark)").matches;Q(n?"dark":"light")}});function _e(e){c(H,e),sessionStorage.setItem("libru:lastUrl",a(H))}function ge(){c(E,Math.min(v,Number((a(E)+u).toFixed(2))))}function we(){c(E,Math.max(p,Number((a(E)-u).toFixed(2))))}function ye(){c(B,!a(B))}function Q(e){c(W,e),document.documentElement.dataset.libruTheme=e,localStorage.setItem(w,e)}function $e(){Q(a(W)==="dark"?"light":"dark")}function Ne(){a(X)&&a(X).scrollIntoView({behavior:"smooth",block:"start"})}function Se(e){if(!e)return[];const t=e.split(`
`),n=[];let s=[];const o=()=>{if(!s.length)return;const m=s.join(" ").replace(/\s{2,}/g," ").trim();m&&n.push(m),s=[]};for(const m of t){const b=m.trim();if(!b){o();continue}if(ce(b)){o(),n.push(b);continue}s.push(b.replace(/\s+/g," "))}return o(),n}function ce(e){return be.test(e.replace(/\s+/g,""))}function Me(e){return`${d.endsWith("/")?d:`${d}/`}${e.href}`}function ke(e){if(!e)return null;const t=e.match(/charset=([^;]+)/i);return t?t[1].trim().toLowerCase():null}function xe(e,t){const n=new Uint8Array(e),s=new Set([t,"utf-8","windows-1251","koi8-r"].filter(o=>!!o));for(const o of s)try{const b=(o==="utf-8"?new TextDecoder(o,{fatal:!0}):new TextDecoder(o)).decode(n);if(o!=="utf-8"||!b.includes("�"))return b}catch{continue}return new TextDecoder().decode(n)}function Ee(e){return e.replace(/&(#x?[0-9a-f]+|[a-z]+);/gi,(t,n)=>{const s=n.toLowerCase();if(s in ie)return ie[s];if(s.startsWith("#x")){const o=Number.parseInt(s.slice(2),16);return Number.isNaN(o)?t:String.fromCharCode(o)}if(s.startsWith("#")){const o=Number.parseInt(s.slice(1),10);return Number.isNaN(o)?t:String.fromCharCode(o)}return t})}function Te(e){const t=e.replace(/<script[\s\S]*?<\/script>/gi,"").replace(/<style[\s\S]*?<\/style>/gi,""),n=t.match(/<pre[^>]*>([\s\S]*?)<\/pre>/i);let s=n?n[1]:t;return s=s.replace(/<br\s*\/?>/gi,`
`).replace(/<\/p>/gi,`

`).replace(/<\/(div|section|article|tr|table|ul|ol|li|h[1-6])>/gi,`
`),s=s.replace(/<[^>]+>/g,""),Ee(s).replace(/\r\n?/g,`
`).replace(/\u00a0/g," ")}async function Pe(){c(y,""),c(q,"");const e=a(H).trim();if(!e){c(y,"Введите полноценный URL с lib.ru.");return}let t;try{t=new URL(e)}catch{c(y,"Введите корректный URL.");return}if(!l.has(t.hostname)){c(y,"Разрешены только ссылки на lib.ru.");return}c(z,!0);try{const n=Me(t),s=await fetch(n,{headers:{accept:me}});if(!s.ok)throw new Error(`Не удалось загрузить текст (код ${s.status}).`);const o=ke(s.headers.get("content-type")),m=await s.arrayBuffer(),b=xe(m,o),V=/<html|<body|<pre/i.test(b)?Te(b):b.replace(/\r\n?/g,`
`);if(!V.trim()){c(y,"Ответ получен, но текст пустой.");return}c(q,V),await Qe(),Ne()}catch(n){n instanceof TypeError?c(y,"Не удалось обратиться к lib.ru. Возможно, сайт недоступен или блокирует прямые запросы."):c(y,n instanceof Error?n.message:"Произошла неизвестная ошибка.")}finally{c(z,!1)}}Xe(()=>a(q),()=>{c(le,Se(a(q)))}),Ge(),je();var ee=Nt();et(e=>{Je.title="Читалка lib.ru"});var G=_(ee),te=_(G),re=S(_(te),2);nt(re),h(te);var ue=S(te,2),Y=_(ue),Ie=_(Y);ct(Ie,{"aria-hidden":"true",class:"libru-icon"}),h(Y);var Z=S(Y,2),Ae=_(Z);it(Ae,{"aria-hidden":"true",class:"libru-icon"}),h(Z);var C=S(Z,2);let de;var Le=_(C);ut(Le,{"aria-hidden":"true",class:"libru-icon"}),h(C);var O=S(C,2),Re=_(O);{var Ce=e=>{vt(e,{"aria-hidden":"true",class:"libru-icon"})},Oe=e=>{pt(e,{"aria-hidden":"true",class:"libru-icon"})};F(Re,e=>{a(W)==="dark"?e(Ce):e(Oe,!1)})}h(O);var ae=S(O,2),Ue=_(ae);{var De=e=>{var t=ht(),n=g(t);ft(n,{"aria-hidden":"true",class:"libru-icon libru-spinner"}),ve(),f(e,t)},Fe=e=>{var t=mt(),n=g(t);dt(n,{"aria-hidden":"true",class:"libru-icon"}),ve(),f(e,t)};F(Ue,e=>{a(z)?e(De):e(Fe,!1)})}h(ae),h(ue),h(G);var fe=S(G,2);{var He=e=>{var t=bt(),n=_(t,!0);h(t),J(()=>se(n,a(y))),f(e,t)};F(fe,e=>{a(y)&&e(He)})}var j=S(fe,2);let pe;var qe=_(j);{var ze=e=>{var t=_t();f(e,t)},Be=(e,t)=>{{var n=o=>{var m=yt();st(m,5,()=>a(le),ot,(b,K)=>{var V=M(),We=g(V);{var Ye=U=>{var T=gt(),ne=_(T,!0);h(T),J(()=>se(ne,a(K))),f(U,T)},Ze=U=>{var T=wt(),ne=_(T,!0);h(T),J(()=>se(ne,a(K))),f(U,T)};F(We,U=>{ce(a(K))?U(Ye):U(Ze,!1)})}f(b,V)}),h(m),f(o,m)},s=o=>{var m=$t();f(o,m)};F(e,o=>{a(q)?o(n):o(s,!1)},t)}};F(qe,e=>{a(z)?e(ze):e(Be,!1)})}h(j),tt(j,e=>c(X,e),()=>a(X)),h(ee),J((e,t)=>{rt(re,a(H)),Y.disabled=a(E)<=p,Z.disabled=a(E)>=v,de=he(C,1,"button icon-only svelte-18nuwd5",null,de,e),oe(C,"aria-pressed",a(B)),oe(O,"aria-label",a(W)==="dark"?"Включить светлую тему":"Включить тёмную тему"),oe(O,"title",a(W)==="dark"?"Светлая тема":"Тёмная тема"),ae.disabled=a(z),pe=he(j,1,"reader svelte-18nuwd5",null,pe,t),at(j,`font-size: ${a(E)}rem;`)},[()=>({active:a(B)}),()=>({ios:a(B)})],Ke),D("input",re,e=>_e(e.target.value)),D("click",Y,we),D("click",Z,ge),D("click",C,ye),D("click",O,$e),D("submit",G,lt(Pe)),f(i,ee),x()}export{At as component};
